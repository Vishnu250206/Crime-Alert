import subprocess
import sys 
import time 
def run_truffle_develop():
    try:
        # Replace the path with the actual path to your Truffle executable directory
        truffle_path = r'C:\Users\useradmin\Desktop\CrimeAlert\Crime-Alert\hello-eth\node_modules\.bin\truffle.cmd'
        # Command to run Truffle develop
        command = [truffle_path, 'develop']

        # Start Truffle develop
        truffle_process = subprocess.Popen(command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True, encoding='utf-8')

        # Wait for Truffle console to start
        time.sleep(10)  # Adjust the delay as needed
        
        # Send the migrate command to Truffle console
        truffle_process.stdin.write("migrate \n")
        # truffle_process.stdin.flush()

        # Read and print standard output
        print("Standard Output:")
        for line in truffle_process.stdout:
            print(line.strip())
            if "Starting migrations" in line:
                break  # Exit loop when the migration process starts

        # Read and print standard error
        # print("Successfully Run")
        for line in truffle_process.stderr:
            print(line.strip())

    except Exception as e:
        print("Error:", e)

if __name__ == "__main__":
    run_truffle_develop()